<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MCreator Web Lite Modular</title>
<style>
  body { 
    font-family: Arial, Helvetica, sans-serif; 
    margin:0; 
    background:#e6f2ff; 
    color:#333; 
    line-height:1.5;
  }
  header { 
    background:#1e3a5f; 
    color:white; 
    padding:1.2em; 
    text-align:center; 
    box-shadow:0 3px 8px rgba(0,0,0,0.3);
  }
  main { 
    padding:1.2em; 
    max-width:920px; 
    margin:0 auto; 
  }
  nav { 
    display:flex; 
    flex-wrap:wrap; 
    margin-bottom:1.2em; 
    justify-content:center; 
    gap:0.4em;
  }
  nav button { 
    flex:1 1 110px; 
    padding:0.8em; 
    cursor:pointer; 
    border:none; 
    border-radius:8px; 
    background:#3a6ea5; 
    color:white; 
    font-weight:bold; 
    transition:0.2s; 
    font-size:0.95em;
  }
  nav button.active, nav button:hover { 
    background:#1e3a5f; 
  }
  section { 
    display:none; 
    background:white; 
    padding:1.4em; 
    border-radius:10px; 
    box-shadow:0 3px 12px rgba(0,0,0,0.15); 
    margin-bottom:1.2em;
  }
  section.active { 
    display:block; 
  }
  input, select, textarea, button { 
    width:100%; 
    margin:0.7em 0; 
    padding:0.7em; 
    box-sizing:border-box; 
    border-radius:6px; 
    border:1px solid #ccc; 
    font-size:1em;
  }
  textarea { 
    height:160px; 
    resize:vertical; 
    font-family: 'Courier New', Courier, monospace;
    white-space: pre;
  }
  img.preview { 
    max-width:160px; 
    margin:0.7em 0; 
    display:block; 
    border:1px solid #aaa; 
    border-radius:8px; 
    box-shadow:0 2px 6px rgba(0,0,0,0.15);
  }
  button { 
    background:#3a6ea5; 
    color:white; 
    font-weight:bold; 
    cursor:pointer; 
    border:none; 
    transition:0.2s;
  }
  button:hover { 
    background:#1e3a5f; 
  }
  .warning {
    background:#fff3cd;
    color:#664d03;
    padding:1em;
    border-radius:8px;
    border:1px solid #ffeeba;
    margin:1.5em 0;
    font-size:0.95em;
  }
  .info {
    color:#555;
    font-size:0.9em;
    margin-top:1em;
  }
</style>
</head>
<body>

<header>
  <h1>MCreator Web Lite Modular</h1>
  <p>Crea tus mods de Minecraft directamente desde el navegador</p>
</header>

<main>
  <nav>
    <button class="tab-btn active" onclick="showTab('blocks')">Bloques</button>
    <button class="tab-btn" onclick="showTab('items')">Items</button>
    <button class="tab-btn" onclick="showTab('mobs')">Mobs</button>
    <button class="tab-btn" onclick="showTab('gui')">GUI</button>
    <button class="tab-btn" onclick="showTab('commands')">Comandos</button>
    <button class="tab-btn" onclick="showTab('armor')">Armaduras</button>
    <button class="tab-btn" onclick="showTab('export')">Exportar</button>
  </nav>

  <!-- Bloques -->
  <section id="blocks" class="active">
    <h2>Crear Bloque</h2>
    <input type="text" id="blockName" placeholder="Nombre del bloque">
    <input type="color" id="blockColor" value="#ff0000">
    <input type="number" id="blockHardness" placeholder="Dureza" value="1.5" step="0.1">
    <input type="number" id="blockResistance" placeholder="Resistencia" value="10" step="0.1">
    <input type="file" id="blockTexture" accept="image/*">
    <img id="blockTexturePreview" class="preview" src="" alt="Vista previa">
    <div>
      <button onclick="generateBlock()">Generar Bloque</button>
      <button onclick="clearFile('blockTexture')">Eliminar Textura</button>
    </div>
    <textarea id="blockOutput" readonly placeholder="Aquí aparecerá el JSON generado..."></textarea>
  </section>

  <!-- Items -->
  <section id="items">
    <h2>Crear Item</h2>
    <input type="text" id="itemName" placeholder="Nombre del item">
    <input type="number" id="itemDamage" placeholder="Daño" value="0">
    <input type="number" id="itemStack" placeholder="Tamaño de stack" value="64">
    <input type="file" id="itemTexture" accept="image/*">
    <img id="itemTexturePreview" class="preview" src="" alt="Vista previa">
    <div>
      <button onclick="generateItem()">Generar Item</button>
      <button onclick="clearFile('itemTexture')">Eliminar Textura</button>
    </div>
    <textarea id="itemOutput" readonly></textarea>
  </section>

  <!-- Mobs -->
  <section id="mobs">
    <h2>Crear Mob</h2>
    <input type="text" id="mobName" placeholder="Nombre del mob">
    <input type="file" id="mobModel" accept=".json,.obj,.png">
    <img id="mobModelPreview" class="preview" src="" alt="Vista previa">
    <div>
      <button onclick="generateMob()">Generar Mob</button>
      <button onclick="clearFile('mobModel')">Eliminar Modelo</button>
    </div>
    <textarea id="mobOutput" readonly></textarea>
  </section>

  <!-- GUI -->
  <section id="gui">
    <h2>Crear GUI</h2>
    <input type="text" id="guiName" placeholder="Nombre de la GUI">
    <input type="file" id="guiImage" accept="image/*">
    <img id="guiImagePreview" class="preview" src="" alt="Vista previa">
    <div>
      <button onclick="generateGUI()">Generar GUI</button>
      <button onclick="clearFile('guiImage')">Eliminar Imagen</button>
    </div>
    <textarea id="guiOutput" readonly></textarea>
  </section>

  <!-- Comandos -->
  <section id="commands">
    <h2>Crear Comando</h2>
    <input type="text" id="commandName" placeholder="Nombre del comando">
    <textarea id="commandCode" placeholder="Escribe aquí el código o comando..."></textarea>
    <button onclick="generateCommand()">Generar Comando</button>
    <textarea id="commandOutput" readonly></textarea>
  </section>

  <!-- Armaduras -->
  <section id="armor">
    <h2>Crear Armadura</h2>
    <input type="text" id="armorName" placeholder="Nombre de la armadura">
    <select id="armorType">
      <option value="helmet">Casco</option>
      <option value="chestplate">Pechera</option>
      <option value="leggings">Pantalones</option>
      <option value="boots">Botas</option>
    </select>
    <input type="file" id="armorTexture" accept="image/*">
    <img id="armorPreview" class="preview" src="" alt="Vista previa">
    <div>
      <button onclick="generateArmor()">Generar Armadura</button>
      <button onclick="clearFile('armorTexture')">Eliminar Textura</button>
    </div>
    <textarea id="armorOutput" readonly></textarea>
  </section>

  <!-- Exportar -->
  <section id="export">
    <h2>Exportar Mod</h2>
    <label>Versión de Minecraft:</label>
    <select id="mcVersion">
      <option>1.20.1</option>
      <option>1.19.4</option>
      <option>1.18.2</option>
      <option>1.16.5</option>
    </select>

    <label>Modloader:</label>
    <select id="modLoader">
      <option>Forge</option>
      <option>Fabric</option>
    </select>

    <button onclick="exportMod()">Exportar y Descargar ZIP</button>

    <div class="warning">
      <strong>¡Importante en iPhone / iPad (Safari)!</strong><br><br>
      Si la descarga no comienza automáticamente:<br>
      1. Mantén presionado el botón unos segundos<br>
      2. Selecciona "Descargar archivo vinculado" o "Guardar en Archivos"<br>
      3. Luego podrás abrirlo desde la app Archivos
    </div>

    <div class="info">
      El ZIP contiene todos los JSON generados + las texturas/modelos que subiste.
    </div>
  </section>
</main>

<!-- Librería JSZip -->
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>

<script>
// ──────────────────────────────────────────────────────────────
// TODAS LAS FUNCIONES JAVASCRIPT ESTÁN AQUÍ
// ──────────────────────────────────────────────────────────────

function showTab(tabId) {
  document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
  document.getElementById(tabId).classList.add('active');
  
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  event.currentTarget.classList.add('active');
}

const fileInputIds = ['blockTexture','itemTexture','mobModel','guiImage','armorTexture'];

fileInputIds.forEach(id => {
  const input = document.getElementById(id);
  if (input) {
    input.addEventListener('change', e => {
      const file = e.target.files[0];
      if (file) {
        document.getElementById(id + 'Preview').src = URL.createObjectURL(file);
      }
    });
  }
});

function clearFile(id) {
  const input = document.getElementById(id);
  if (input) input.value = '';
  const preview = document.getElementById(id + 'Preview');
  if (preview) preview.src = '';
}

// Generadores
function generateBlock() {
  const data = {
    type: "block",
    name: document.getElementById('blockName').value.trim(),
    color: document.getElementById('blockColor').value,
    hardness: parseFloat(document.getElementById('blockHardness').value) || 1,
    resistance: parseFloat(document.getElementById('blockResistance').value) || 10,
    texture: document.getElementById('blockTexture').files[0]?.name || ""
  };
  document.getElementById('blockOutput').value = JSON.stringify(data, null, 2);
}

function generateItem() {
  const data = {
    type: "item",
    name: document.getElementById('itemName').value.trim(),
    damage: parseInt(document.getElementById('itemDamage').value) || 0,
    stack: parseInt(document.getElementById('itemStack').value) || 64,
    texture: document.getElementById('itemTexture').files[0]?.name || ""
  };
  document.getElementById('itemOutput').value = JSON.stringify(data, null, 2);
}

function generateMob() {
  const data = {
    type: "mob",
    name: document.getElementById('mobName').value.trim(),
    model: document.getElementById('mobModel').files[0]?.name || ""
  };
  document.getElementById('mobOutput').value = JSON.stringify(data, null, 2);
}

function generateGUI() {
  const data = {
    type: "gui",
    name: document.getElementById('guiName').value.trim(),
    image: document.getElementById('guiImage').files[0]?.name || ""
  };
  document.getElementById('guiOutput').value = JSON.stringify(data, null, 2);
}

function generateCommand() {
  const data = {
    type: "command",
    name: document.getElementById('commandName').value.trim(),
    code: document.getElementById('commandCode').value
  };
  document.getElementById('commandOutput').value = JSON.stringify(data, null, 2);
}

function generateArmor() {
  const data = {
    type: "armor",
    name: document.getElementById('armorName').value.trim(),
    slot: document.getElementById('armorType').value,
    texture: document.getElementById('armorTexture').files[0]?.name || ""
  };
  document.getElementById('armorOutput').value = JSON.stringify(data, null, 2);
}

// Exportación
async function exportMod() {
  const zip = new JSZip();
  const sections = [
    ['blocks.json',   'blockOutput',  'blockTexture'],
    ['items.json',    'itemOutput',   'itemTexture'],
    ['mobs.json',     'mobOutput',    'mobModel'],
    ['gui.json',      'guiOutput',    'guiImage'],
    ['commands.json', 'commandOutput',''],
    ['armors.json',   'armorOutput',  'armorTexture']
  ];

  let hasContent = false;

  for (const [filename, textareaId, fileInputId] of sections) {
    const textarea = document.getElementById(textareaId);
    if (textarea && textarea.value.trim()) {
      zip.file(filename, textarea.value.trim());
      hasContent = true;
    }
    if (fileInputId) {
      const file = document.getElementById(fileInputId)?.files?.[0];
      if (file) {
        zip.file(file.name, file);
        hasContent = true;
      }
    }
  }

  if (!hasContent) {
    alert("No has generado ningún elemento.\nCrea al menos un bloque, item, mob, etc. antes de exportar.");
    return;
  }

  const metadata = {
    mcVersion: document.getElementById('mcVersion').value,
    modLoader: document.getElementById('modLoader').value,
    exportedAt: new Date().toISOString(),
    generator: "MCreator Web Lite Modular"
  };
  zip.file("metadata.json", JSON.stringify(metadata, null, 2));

  try {
    const blob = await zip.generateAsync({type: "blob"});
    const url = URL.createObjectURL(blob);

    const a = document.createElement('a');
    a.href = url;
    a.download = `mod_${metadata.mcVersion}_${metadata.modLoader}.zip`;
    document.body.appendChild(a);
    a.click();

    setTimeout(() => {
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }, 150);
  } catch (err) {
    console.error("Error al generar ZIP:", err);
    alert("No se pudo crear el archivo ZIP.\nRevisa la consola para más detalles.");
  }
}
</script>
</body>
</html>